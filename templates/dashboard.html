{% extends "base.html" %}
{% block title %}Dashboard | Fire Alarm{% endblock %}

{% block body %}
<div class="container mx-auto py-8">
  <!-- Icon and Title -->
  <div class="flex flex-col items-center mb-8">
    <img src="{{ url_for('static', filename='img/fire_sensor.png') }}" alt="Sensor Icon" class="w-32 h-32 mb-4" />
    <h1 class="text-4xl font-bold text-white">Giám sát cảm biến</h1>
  </div>
  
  <!-- Sensor Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-lg overflow-hidden">
      <thead class="bg-orange-600 text-white">
        <tr>
          <th class="px-4 py-3">Địa chỉ thiết bị</th>
          <th class="px-4 py-3">Nhiệt độ (°C)</th>
          <th class="px-4 py-3">Độ ẩm (%)</th>
          <th class="px-4 py-3">Nồng độ gas</th>
          <th class="px-4 py-3">Dấu báo lửa</th>
        </tr>
      </thead>
      <tbody id="sensor-data" class="text-gray-800">
        <tr>
          <td colspan="5" class="text-center py-6">Đang chờ dữ liệu...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "https://firedetection-23fe9-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  const dbRef = firebase.database().ref('DataSensorRealTime');
  dbRef.on('value', snapshot => {
    const data = snapshot.val() || {};
    const tbody = document.getElementById('sensor-data');
    tbody.innerHTML = '';

    Object.entries(data).forEach(([sid, item]) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border px-4 py-2">${item.send_address || sid}</td>
        <td class="border px-4 py-2">${item.temperature ?? '—'}</td>
        <td class="border px-4 py-2">${item.humidity ?? '—'}</td>
        <td class="border px-4 py-2">${item.mq2 ?? '—'}</td>
        <td class="border px-4 py-2">${item.fire ? '<span class="text-red-600">Có</span>' : 'Không'}</td>
      `;
      tbody.appendChild(tr);
    });

    if (!Object.keys(data).length) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-6">Chưa có dữ liệu</td></tr>';
    }
  });
</script>
{% endblock %}
